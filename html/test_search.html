<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Atlas of Economic Complexity | Search</title>
<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/flick/jquery-ui.css" type="text/css" media="all" />
<link rel="search" type="application/opensearchdescription+xml" href="/media/opensearch.xml" title="Atlas of Economic Complexity"/>
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<style>
</style>
<script>

// Function to read query parameters
function getQueryParameterByName(name) {
    var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
    return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
}

// jQuery hack to highlight search terms
$(function() {
$.ui.autocomplete.prototype._renderItem = function( ul, item){
  var term = this.term.split(' ').join('|');
  var re = new RegExp("(" + term + ")", "gi") ;
  var t = item.label.replace(re,"<b>$1</b>");
  return $( "<li></li>" )
     .data( "item.autocomplete", item )
     .append( "<a>" + t + "</a>" )
     .appendTo( ul );
};

// Set up autocomplete callback
var cache = {};
$("#searchbar").autocomplete({
minLength: 3,
delay: 260,
source: function(request, response) {
    var term = request.term;
    if (term in cache) {
        response(cache[term]);
        return;
    }
    $.getJSON( "/api/search/",
        request,
        function(data, status, xhr) {
            cache[term] = data;
            response(data);
    });
    },
select: function(event, ui){
    event.preventDefault();
    $(this).val(ui.item.label);
    window.location.href="/" + ui.item.value;
},
});


querystring = getQueryParameterByName("term");
var bar = $("#searchbar");
bar.val(querystring);
bar.autocomplete("search", querystring);
bar.focus();

        });
</script>
</head>
<body>
<div class="ui-widget">
    <label for="searchbar">Atlas Search: </label>
    <input id="searchbar">
</div>
</body>
</html>
